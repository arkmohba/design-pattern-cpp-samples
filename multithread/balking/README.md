# 概要

Balkingパターンを実装してみたもの。

* Guarded Suspensionとは違い、ガード条件が成立しなければ処理を中止する。
* ガードされたメソッドを持つクラスをGuardedObjectと呼ぶ
  * guarded_method＝save()
  * 状態を変化させるメソッドを持つことがある。（今回はchangeメソッド）
* 使うケース（処理の前にbalkしたくなるケース）
  * あえて処理が必要ない場合（今回はこのケース）
    * 無駄な再書き込みを避けてパフォーマンスを上げる効果がある。
  * ガード条件が満たされるのを待ちたくない場合
    * すぐに次の作業に進みたい場合。→応答性を上げる。
  * ガード条件が満たされるのが最初の一回だけという場合
    * 初期化など。（オブジェクトを使い回すときなど？）
    * この場合、guarded suspensionを使うと未初期化まで待つというよくわからないことになる。
      * ガード条件が2回目満たされることは絶対ない。
    * たった一度だけ状態が変化する変数をラッチと呼ぶ。
* balkの結果を表現する方法
  * balkの発生を無視する方法
    * 呼び出し側にbalkの発生を伝えない。
  * balkの発生を戻り地で表現する方法
    * boolで返す。
  * 例外で表現する方法
    * メソッドからthrowする方法。
* タイムアウトについて
  * ガード条件が満たさなければbalkするのではなく、一定時間waitしてガード条件が満たされなければbalkする。→guarded timed, timeoutと呼ぶ。
  * waitが解除されるのはnotify_one, notify_all, timeoutの場合。
    * 上記の区別はつかない。notify系ではなくtimeoutの場合には、エラーなりを出さなくてはならないので、コード中で時間を計測する必要がある。
* ガード条件のテストはsynchronizedメソッド内で実行する。


# 所感

* 同じメソッドを複数のスレッドが使う場合とかに使う？
* balkして次に進むと言っても、複数の処理を巡回して1つのスレッドがまとめて処理を実行するのは多分間違っていて、処理と処理をつなぐパイプラインを作るほうが正しそう。
